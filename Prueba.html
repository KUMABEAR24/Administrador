<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Doctor de API Key Gemini</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white p-10 flex flex-col items-center">
    <div class="max-w-2xl w-full bg-gray-800 p-6 rounded-lg shadow-xl">
        <h1 class="text-2xl font-bold mb-4 text-indigo-400">Diagnóstico de API Key</h1>
        <p class="mb-4 text-gray-300">Vamos a ver qué modelos están realmente disponibles para tu clave.</p>
        
        <input type="text" id="api-key" placeholder="Pega tu API Key aquí" class="w-full p-3 text-black rounded mb-4" />
        <button onclick="checkKey()" class="w-full bg-indigo-600 hover:bg-indigo-700 font-bold py-2 px-4 rounded">
            VERIFICAR MODELOS DISPONIBLES
        </button>

        <div id="results" class="mt-6 p-4 bg-black rounded min-h-[100px] font-mono text-xs whitespace-pre-wrap"></div>
    </div>

    <script>
        async function checkKey() {
            const key = document.getElementById('api-key').value.trim();
            const consoleDiv = document.getElementById('results');
            
            if(!key) { alert("Pega la clave primero"); return; }
            
            consoleDiv.textContent = "Conectando con Google...";
            consoleDiv.className = "mt-6 p-4 bg-black rounded min-h-[100px] font-mono text-xs whitespace-pre-wrap text-yellow-400";

            try {
                // Hacemos una petición para LISTAR los modelos disponibles para TU clave
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models?key=${key}`);
                const data = await response.json();

                if (data.error) {
                    consoleDiv.className = "mt-6 p-4 bg-red-900 rounded font-mono text-white";
                    consoleDiv.textContent = `ERROR GRAVE:\nCódigo: ${data.error.code}\nMensaje: ${data.error.message}\n\nCAUSA PROBABLE: Tu API Key es inválida, expiró o no tiene facturación habilitada.`;
                    return;
                }

                consoleDiv.className = "mt-6 p-4 bg-green-900 rounded font-mono text-white";
                let output = "CONEXIÓN EXITOSA. MODELOS DISPONIBLES:\n--------------------------------------\n";
                
                // Filtramos solo los modelos que sirven para generar contenido (generateContent)
                const validModels = data.models.filter(m => m.supportedGenerationMethods.includes("generateContent"));

                if (validModels.length === 0) {
                    output += "NINGUNO. Tu clave funciona, pero no tienes acceso a modelos de generación de texto.";
                } else {
                    validModels.forEach(m => {
                        // Limpiamos el nombre (viene como models/gemini-pro)
                        const simpleName = m.name.replace('models/', '');
                        output += `✅ ${simpleName}\n`;
                    });
                    output += "\n--------------------------------------\nCOPIA UNO DE ESTOS NOMBRES EXACTAMENTE.";
                }

                consoleDiv.textContent = output;

            } catch (error) {
                consoleDiv.className = "mt-6 p-4 bg-red-900 rounded font-mono text-white";
                consoleDiv.textContent = `ERROR DE RED: ${error.message}. Verifica tu conexión a internet.`;
            }
        }
    </script>
</body>
</html>
